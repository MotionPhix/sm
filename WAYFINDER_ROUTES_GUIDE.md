# Wayfinder Routes + useRoleRoutes Pattern

## Overview

This application uses a **two-part pattern** for routing and permissions:

1. **`useRoleRoutes` Composable** - Permission checks and role-based access control
2. **Wayfinder Routes** - Type-safe, directly imported route functions

This ensures a **single source of truth** for both permissions and routes, with compile-time type safety.

## The Pattern

### In Components

```typescript
// 1. Import the permission composable
import { useRoleRoutes } from '@/composables/useRoleRoutes'

// 2. Import Wayfinder routes directly
import { create as termsCreate, edit as termsEdit, destroy as termsDestroy } from '@/routes/admin/settings/terms'

// 3. Use the composable for permission checks
const { canAccessAdmin } = useRoleRoutes()

// 4. Use imported routes for navigation
<Button :as="ModalLink" :href="termsCreate().url" v-if="canAccessAdmin">
    Add Term
</Button>
```

## Why This Pattern?

### ✅ Single Source of Truth
- Routes are defined in controllers and auto-generated by Wayfinder
- Permissions are managed in one composable
- No hardcoded route strings anywhere

### ✅ Compile-Time Type Safety
- If a route is renamed/deleted, the import fails immediately
- TypeScript catches breaking changes before runtime
- Full IDE autocomplete support

### ✅ Easy Maintenance
- Change a route → Wayfinder regenerates it
- Change permissions → Update composable
- No need to hunt down hardcoded route strings

### ✅ No Circular Dependencies
- Routes imported directly in components
- Composable only handles permissions
- Clean separation of concerns

## Updated Pages

### Terms Management
**File:** `resources/js/pages/admin/settings/terms/Index.vue`

Routes imported:
- `termsCreate()` - Create term modal
- `termsEdit(id)` - Edit term modal  
- `termsDestroy(id)` - Delete term
- `termsGenerateDefaults()` - Generate default terms

### Admission Cycles Management
**File:** `resources/js/pages/admin/settings/admission-cycles/Index.vue`

Routes imported:
- `admissionCyclesCreate()` - Create cycle modal
- `admissionCyclesEdit(id)` - Edit cycle modal
- `admissionCyclesDestroy(id)` - Delete cycle

## Available Routes by Module

### Admin Settings - Terms
```typescript
import { 
    index,                  // List all terms
    create,                 // Create modal
    edit,                   // Edit modal (requires ID)
    store,                  // Store (POST)
    update,                 // Update (requires ID)
    destroy,                // Delete (requires ID)
    generateDefaults,       // Generate 3-term defaults
} from '@/routes/admin/settings/terms'
```

### Admin Settings - Admission Cycles
```typescript
import {
    index,                  // List all cycles
    create,                 // Create modal
    edit,                   // Edit modal (requires ID)
    store,                  // Store (POST)
    update,                 // Update (requires ID)
    destroy,                // Delete (requires ID)
} from '@/routes/admin/settings/admission-cycles'
```

### Admin - Staff
```typescript
import {
    index,                  // List all staff
    invite,                 // Invite modal
    store,                  // Store invitation (POST)
} from '@/routes/admin/staff'
```

### Registrar - Admissions
```typescript
import {
    index,                  // List all admissions
    create,                 // Create modal
    edit,                   // Edit modal (requires ID)
    store,                  // Store (POST)
    update,                 // Update (requires ID)
    destroy,                // Delete (requires ID)
    show,                   // Show detail (requires ID)
} from '@/routes/registrar/admissions'
```

## useRoleRoutes Composable

### Permission Checks

```typescript
const { 
    canAccessAdmin,      // Can access admin features
    canAccessRegistrar,  // Can access registrar features
    canAccessTeacher,    // Can access teacher features
    isSuperAdmin,        // Is super admin
    isAdmin,             // Is school admin
    userRole,            // Current user's role
} = useRoleRoutes()
```

### Usage Example

```vue
<script setup>
import { useRoleRoutes } from '@/composables/useRoleRoutes'
import { create as termsCreate } from '@/routes/admin/settings/terms'

const { canAccessAdmin } = useRoleRoutes()
</script>

<template>
    <div v-if="canAccessAdmin">
        <Button :as="ModalLink" :href="termsCreate().url">
            Add Term
        </Button>
    </div>
</template>
```

## Route Function Return Values

All Wayfinder routes return objects with `url` and `method`:

```typescript
// Example return value
{
    url: "/admin/settings/terms",        // The full route path
    method: "get"                        // HTTP method
}

// Usage
:href="termsCreate().url"              // Extract URL
router.delete(termsDestroy(id).url)    // Use in router calls
```

## Migration Guide for New Features

When adding new routes:

1. **Create the controller method** that returns `Inertia::render()`
2. **Add the route** in `routes/admin.php` (or appropriate file)
3. **Run Wayfinder regeneration** (automatic via Vite plugin)
4. **Import in components**:
   ```typescript
   import { create, edit, destroy } from '@/routes/admin/new-module'
   ```
5. **Check permissions**:
   ```typescript
   const { canAccessAdmin } = useRoleRoutes()
   ```
6. **Use in templates**:
   ```vue
   <Button :as="ModalLink" :href="create().url" v-if="canAccessAdmin">
       Create
   </Button>
   ```

## Key Principles

1. **Never hardcode routes** - Always import from Wayfinder
2. **Permission checks in composable** - All access control in one place
3. **Direct route imports** - Components import what they need
4. **Type safety first** - Let TypeScript catch breaking changes
5. **Consistent patterns** - Follow the established structure for new features

## Common Mistakes to Avoid

❌ **Don't hardcode routes:**
```typescript
// BAD
router.delete('/admin/settings/terms/' + id)

// GOOD
import { destroy } from '@/routes/admin/settings/terms'
router.delete(destroy(id).url)
```

❌ **Don't expose routes through composable:**
```typescript
// BAD - creates circular dependency risk
export function useRoleRoutes() {
    return {
        termsCreateRoute: termsCreate,
        // ...
    }
}

// GOOD - import directly in components
import { create as termsCreate } from '@/routes/admin/settings/terms'
```

❌ **Don't skip permission checks:**
```typescript
// BAD - no permission check
<Button :href="termsCreate().url">Add</Button>

// GOOD - permission checked
<Button :href="termsCreate().url" v-if="canAccessAdmin">Add</Button>
```

## Benefits Summary

| Aspect | Benefit |
|--------|---------|
| **Maintainability** | Routes defined once, used everywhere |
| **Type Safety** | Breaking changes caught at compile time |
| **Refactoring** | Safe to rename routes - compiler alerts |
| **Permissions** | Single source of truth for access control |
| **IDE Support** | Full autocomplete for all routes |
| **No Strings** | Zero hardcoded route paths |
